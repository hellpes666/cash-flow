# Cash Flow Backend

Backend —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–∏—á–Ω—ã–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –Ω–∞ NestJS —Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- Docker –∏ Docker Compose
- npm/yarn/pnpm

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

    ```bash
    npm install
    ```

2. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:**

    ```env
    POSTRGES_URI=postgresql://user:password@localhost:5436/cashflow
    POSTGRES_USER=user
    POSTGRES_PASSWORD=password
    RABBITMQ_DEFAULT_USER=admin
    RABBITMQ_DEFAULT_PASS=admin
    RABBITMQ_DEFAULT_HOST=localhost
    PORT=3000
    JWT_SECRET=your-secret-key-here
    ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É:**

    ```bash
    docker-compose up -d
    ```

4. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**

    ```bash
    npx prisma migrate dev
    npx prisma generate
    ```

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
    ```bash
    npm run start:dev
    ```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:3000`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ domains/          # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ (DDD)
‚îÇ   ‚îú‚îÄ‚îÄ auth/         # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ user/         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ account/      # –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ actions/      # –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ orders/       # –ó–∞–∫–∞–∑—ã
‚îÇ   ‚îú‚îÄ‚îÄ payment/      # –ü–ª–∞—Ç–µ–∂–∏ (YooKassa)
‚îÇ   ‚îî‚îÄ‚îÄ integrations/ # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ lib/              # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ prisma/       # Prisma —Å–µ—Ä–≤–∏—Å
‚îÇ   ‚îî‚îÄ‚îÄ utils/        # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ rmq/              # RabbitMQ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ consumer/     # –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ producer/     # –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îî‚îÄ‚îÄ main.ts           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

- **Domain-Driven Design (DDD)** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ –¥–æ–º–µ–Ω–∞–º
- **Layered Architecture** ‚Äî Controllers ‚Üí Services ‚Üí Data Access
- **Dependency Injection** ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π DI NestJS
- **Microservices** ‚Äî RabbitMQ –¥–ª—è –º–µ–∂—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- **DTO Pattern** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ class-validator
- **Repository Pattern** ‚Äî Prisma –∫–∞–∫ —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º

### –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏

- **Auth** ‚Äî JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω
- **User** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Account** ‚Äî –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å—á–µ—Ç–∞ –∏ –∫–æ—à–µ–ª—å–∫–∏
- **Actions** ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–¥–æ—Ö–æ–¥—ã/—Ä–∞—Å—Ö–æ–¥—ã), —Ü–µ–ª–∏, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **Orders** ‚Äî –∑–∞–∫–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **Payment** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å YooKassa –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
- **Integrations** ‚Äî –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- **@nestjs/core** (^11.0.1) ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ NestJS
- **@nestjs/microservices** (^11.1.9) ‚Äî –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
- **@prisma/client** (^6.18.0) ‚Äî ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- **@nestjs/jwt** (^11.0.1) ‚Äî JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **bcrypt** (^6.0.0) ‚Äî —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **class-validator** (^0.14.2) ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO
- **amqplib** (^0.10.9) ‚Äî RabbitMQ –∫–ª–∏–µ–Ω—Ç
- **axios** (^1.13.2) ‚Äî HTTP –∫–ª–∏–µ–Ω—Ç

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **PostgreSQL 17** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î
- **Prisma** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ ORM
- **RabbitMQ 3.13** ‚Äî –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π

## üìù –°–∫—Ä–∏–ø—Ç—ã

```bash
npm run start          # –ó–∞–ø—É—Å–∫
npm run start:dev      # –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å hot-reload
npm run start:prod     # –ü—Ä–æ–¥–∞–∫—à–µ–Ω
npm run build          # –°–±–æ—Ä–∫–∞
npm run lint           # –õ–∏–Ω—Ç–∏–Ω–≥
npm run test           # –¢–µ—Å—Ç—ã
npm run test:e2e       # E2E —Ç–µ—Å—Ç—ã
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (class-validator)
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Guards –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤

## üê≥ Docker

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ Docker Compose:

- **PostgreSQL** ‚Äî –ø–æ—Ä—Ç 5436
- **RabbitMQ** ‚Äî –ø–æ—Ä—Ç—ã 5672 (AMQP), 15672 (Management UI)

```bash
docker-compose up -d        # –ó–∞–ø—É—Å–∫
docker-compose down         # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose logs -f      # –õ–æ–≥–∏
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º

### NestJS

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.nestjs.com/)
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã, DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, WebSockets, GraphQL

### Prisma

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.prisma.io/docs)
- ORM —Å type-safe –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ú–∏–≥—Ä–∞—Ü–∏–∏, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞

### RabbitMQ

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://www.rabbitmq.com/documentation.html)
- AMQP –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- –û—á–µ—Ä–µ–¥–∏, –æ–±–º–µ–Ω–Ω–∏–∫–∏, routing

### JWT

- [jsonwebtoken](https://github.com/auth0/node-jsonwebtoken)
- Access/Refresh —Ç–æ–∫–µ–Ω—ã
- –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è

## üîÑ API Endpoints

–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ –¥–æ–º–µ–Ω–∞–º:

- `/auth` ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `/user` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `/account` ‚Äî —Å—á–µ—Ç–∞
- `/actions` ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- `/orders` ‚Äî –∑–∞–∫–∞–∑—ã
- `/payment` ‚Äî –ø–ª–∞—Ç–µ–∂–∏

## üì¶ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –û–ø–∏—Å–∞–Ω–∏–µ                     | –ü—Ä–∏–º–µ—Ä                                     |
| ----------------------- | ---------------------------- | ------------------------------------------ |
| `POSTRGES_URI`          | URI –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL | `postgresql://user:pass@localhost:5436/db` |
| `POSTGRES_USER`         | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë–î              | `user`                                     |
| `POSTGRES_PASSWORD`     | –ü–∞—Ä–æ–ª—å –ë–î                    | `password`                                 |
| `RABBITMQ_DEFAULT_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å RabbitMQ        | `admin`                                    |
| `RABBITMQ_DEFAULT_PASS` | –ü–∞—Ä–æ–ª—å RabbitMQ              | `admin`                                    |
| `RABBITMQ_DEFAULT_HOST` | –•–æ—Å—Ç RabbitMQ                | `localhost`                                |
| `PORT`                  | –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è              | `3000`                                     |
| `JWT_SECRET`            | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT       | `your-secret-key`                          |
